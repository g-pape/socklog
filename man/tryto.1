.TH tryto 1
.SH NAME
tryto - tries to run a command limited by a timeout or number of tries,
can be used to run as multilog(8) processor.
.SH SYNOPSIS
.B tryto
[
.B \-pv
]
[
.B \-t
.I sec
]
[
.B \-k
.I ksec
]
[
.B \-n
.I tries
]
.I prog
.SH DESCRIPTION
.I prog
consist of one or more arguments.
.LP
.B tryto
runs and watches
.IR prog ,
feeding its standard input to
.IR prog 's
standard input.
If
.I prog
exits with an error code other then 0,
.B tryto
runs
.I prog
again after sleeping one second.
.LP
If the number of retries reaches the maximal
number of
.IR tries ,
.B tryto
prints an error message and gives up.
.LP
If the timeout
.I sec
seconds is reached and
.I prog
is still running,
.B tryto
sends a TERM signal to
.IR prog ,
waits
.I ksec
seconds for
.I prog
to terminate, then sends a KILL signal if
.I prog
still is there, and exits as soon as possible.
.LP
The main purpose of
.B tryto
is to run as
.BR multilog (8)
processor (see below). Without the
.B \-p
option,
.B tryto
does just a subset of what
.BR timelimit (8)
from Peter Pentchev provides.
.SH OPTIONS
.TP
.B \-v
verbose. print verbose messages to stderr.
.TP
.B \-p
processor. Use this option if you run
.B tryto
as a
.BR multilog (8)
processor (see below).
.TP
.B \-t \fIsec
timeout. Set the timeout to send TERM to
.I prog
to
.I sec
seconds. Default is 180.
.TP
.B \-k \fIksec
kill timeout. Set the timeout to send KILL to
.I prog
to
.I ksec
seconds. Default is 5.
.TP
.B \-n \fItries
Set the maximal number of tries to
.IR tries .
If
.I prog
has crached,
.B tryto
tries to rewind stdin to the beginning using
.IR lseek (2)
before starting
.I prog
again. Default is 5.
.SH MULTILOG PROCESSOR
If
.B tryto
sees the
.B -p
option,
.B tryto
runs as a
.BR multilog (8)
processor, making use of filedescriptors 4 and 5:
.LP
After forking,
.B tryto
moves the filedescriptor 5 to 2, so all error messages from
.B tryto
and
.I prog
will be saved in
.BR multilog (8)'s
.I state
to be processed on the next run of
.B tryto 
.BR \-p .
.LP
After starting
.IR prog ,
.B tryto
first feeds all data it reads from filedescriptor 4 to
.IR prog 's
standard input, then all data from filedescriptor 0.
.LP
If
.I prog
fails by timeout
.I sec
seconds or maximal number of
.IR tries ,
.B tryto
prints all data from standard input to standard output, an error message
to filedesriptor 5 and exits with 0.
.SH EXIT CODES
If
.B tryto
itself failes, it returns 111.
.LP
If
.B tryto
runs as a
.BR multilog (8)
processor,
.B tryto
returns 0 in all other cases.
.LP
If
.I prog
was run successfully,
.B tryto
returns 0.
.LP
If
.I prog
failed by timeout,
.B tryto
returns 10.
.LP
If
.I prog
failed by maximal number of
.IR tries ,
.B tryto
returns the last exit code from
.IR prog .
.LP
.SH SEE ALSO
multilog(8),
socklog(8),
uncat(1),
lseek(2),
timelimit(8)
.LP
http://innominate.org/~pape/socklog/
.SH AUTHOR
G. Pape <pape@innominate.com>
