


<HTML>
<HEAD>
<TITLE>tryto(1) manual page</TITLE>
</HEAD>
<BODY bgcolor=white>
<a href="http://innominate.org/~pape/">G. Pape</a><br><A HREF="index.html">socklog</A><hr><P>

<H2><A NAME="sect0">Name</A></H2>
tryto - tries to run a command limited by a timeout or number of tries,
can be used to run as <I>multilog(8)</I> processor. 
<H2><A NAME="sect1">Synopsis</A></H2>
<B>tryto</B> [ <B>-pv</B> ] [ <B>-t</B> <I>sec</I>
] [ <B>-k</B> <I>ksec</I> ] [ <B>-n</B> <I>tries</I> ] <I>prog</I> 
<H2><A NAME="sect2">Description</A></H2>
<I>prog</I> consist of one or more arguments.
<P>
<B>tryto</B> runs and watches <I>prog</I>, feeding its standard input to <I>prog</I>'s standard
input. If <I>prog</I> exits with an error code other then 0, <B>tryto</B> runs <I>prog</I> again
after sleeping one second. <P>
If the number of retries reaches the maximal
number of <I>tries</I>, <B>tryto</B> prints an error message and gives up. <P>
If the timeout
<I>sec</I> seconds is reached and <I>prog</I> is still running, <B>tryto</B> sends a TERM signal
to <I>prog</I>, waits <I>ksec</I> seconds for <I>prog</I> to terminate, then sends a KILL signal
if <I>prog</I> still is there, and exits as soon as possible. <P>
The main purpose
of <B>tryto</B> is to run as <B><I>multilog</B>(8)</I> processor (see below). Without the <B>-p</B> option,
<B>tryto</B> does just a subset of what <B><I>timelimit</B>(8)</I> from Peter Pentchev provides.

<H2><A NAME="sect3">Options</A></H2>

<DL>

<DT><B>-v</B> </DT>
<DD>verbose. print verbose messages to stderr. </DD>

<DT><B>-p</B> </DT>
<DD>processor. Use this
option if you run <B>tryto</B> as a <B><I>multilog</B>(8)</I> processor (see below). </DD>

<DT><B>-t <I>sec</B> </I></DT>
<DD>timeout.
Set the timeout to send TERM to <I>prog</I> to <I>sec</I> seconds. Default is 180. </DD>

<DT><B>-k <I>ksec</B>
</I></DT>
<DD>kill timeout. Set the timeout to send KILL to <I>prog</I> to <I>ksec</I> seconds. Default
is 5. </DD>

<DT><B>-n <I>tries</B> </I></DT>
<DD>Set the maximal number of tries to <I>tries</I>. If <I>prog</I> has crached,
<B>tryto</B> tries to rewind stdin to the beginning using <I><I>lseek</I>(2)</I> before starting
<I>prog</I> again. Default is 5. </DD>
</DL>

<H2><A NAME="sect4">Multilog Processor</A></H2>
If <B>tryto</B> sees the <B>-p</B> option, <B>tryto</B>
runs as a <B><I>multilog</B>(8)</I> processor, making use of filedescriptors 4 and 5:
<P>
After forking, <B>tryto</B> moves the filedescriptor 5 to 2, so all error messages
from <B>tryto</B> and <I>prog</I> will be saved in <B><I>multilog</B>(8)</I>'s <I>state</I> to be processed
on the next run of <B>tryto </B> <B>-p</B>. <P>
After starting <I>prog</I>, <B>tryto</B> first feeds all
data it reads from filedescriptor 4 to <I>prog</I>'s standard input, then all data
from filedescriptor 0. <P>
If <I>prog</I> fails by timeout <I>sec</I> seconds or maximal number
of <I>tries</I>, <B>tryto</B> prints all data from standard input to standard output,
an error message to filedesriptor 5 and exits with 0. 
<H2><A NAME="sect5">Exit Codes</A></H2>
If <B>tryto</B>
itself failes, it returns 111. <P>
If <B>tryto</B> runs as a <B><I>multilog</B>(8)</I> processor,
<B>tryto</B> returns 0 in all other cases. <P>
If <I>prog</I> was run successfully, <B>tryto</B>
returns 0. <P>
If <I>prog</I> failed by timeout, <B>tryto</B> returns 10. <P>
If <I>prog</I> failed by
maximal number of <I>tries</I>, <B>tryto</B> returns the last exit code from <I>prog</I>. <P>

<H2><A NAME="sect6">See
Also</A></H2>
<I>multilog(8)</I>, <I>socklog(8)</I>, <I>uncat(1)</I>, <I>lseek(2)</I>, <I>timelimit(8)</I> <P>
<I>http://innominate.org/~pape/socklog/</I>

<H2><A NAME="sect7">Author</A></H2>
Gerrit Pape &lt;pape@smarden.org&gt; <P>

<HR><P>
<A NAME="toc"><B>Table of Contents</B></A><P>
<UL>
<LI><A NAME="toc0" HREF="#sect0">Name</A></LI>
<LI><A NAME="toc1" HREF="#sect1">Synopsis</A></LI>
<LI><A NAME="toc2" HREF="#sect2">Description</A></LI>
<LI><A NAME="toc3" HREF="#sect3">Options</A></LI>
<LI><A NAME="toc4" HREF="#sect4">Multilog Processor</A></LI>
<LI><A NAME="toc5" HREF="#sect5">Exit Codes</A></LI>
<LI><A NAME="toc6" HREF="#sect6">See Also</A></LI>
<LI><A NAME="toc7" HREF="#sect7">Author</A></LI>
</UL>
</BODY></HTML>
