<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>socklog - examples</title>
</head>
<body>
<a href="http://smarden.org/pape/">G. Pape</a><br>
<a href="index.html">socklog</a><br>
<hr>
<h1>socklog - examples</h1>
<hr>
<h2>
listening on unix domain dgram socket <tt>/dev/log</tt>:
</h2>
<ul>
  <li>a sample <tt>socklog-unix/run</tt> script:
  <pre>
  #!/bin/sh
  exec 2>&1
  exec softlimit -m 2000000 envuidgid nobody socklog unix /dev/log
  </pre>
  <li>a sample <tt>socklog-unix/log/run</tt> script:
  <pre>
  #!/bin/sh
  LOGDIR=/var/log/socklog
  exec setuidgid log multilog ${LOGDIR}/main \
    s999999 n10 -* +kern.* ${LOGDIR}/kern \
    s999999 n10 -* +user.* ${LOGDIR}/user \
    s999999 n10 -* +mail.* ${LOGDIR}/mail \
    s999999 n10 -* +daemon.* ${LOGDIR}/daemon \
    s999999 n10 -* +auth.* +authpriv.* ${LOGDIR}/auth \
    s999999 n10 -* +syslog.* ${LOGDIR}/syslog \
    s999999 n10 -* +news.* ${LOGDIR}/news \
    s999999 n10 -* +cron.* ${LOGDIR}/cron \
    s999999 n10 -* +ftp.* ${LOGDIR}/ftp \
    s999999 n10 -* +local*.* ${LOGDIR}/local \
    s999999 n10 -* +*.debug* ${LOGDIR}/debug
  </pre>
  <li>if you want additional
  <a href="http://cr.yp.to/daemontools/tai64n.html">tai64n</a>
  (# man tai64n) timestamps prepended to each message, use this
  <tt>socklog-unix/log/run</tt> script as example:
  <pre>
  #!/bin/sh
  LOGDIR=/var/log/socklog
  exec setuidgid log multilog t ${LOGDIR}/main \
    s999999 n10 -* +'* kern.*' ${LOGDIR}/kern \
    s999999 n10 -* +'* user.*' ${LOGDIR}/user \
    s999999 n10 -* +'* mail.*' ${LOGDIR}/mail \
    s999999 n10 -* +'* daemon.*' ${LOGDIR}/daemon \
    s999999 n10 -* +'* auth.*' +authpriv.* ${LOGDIR}/auth \
    s999999 n10 -* +'* syslog.*' ${LOGDIR}/syslog \
    s999999 n10 -* +'* news.*' ${LOGDIR}/news \
    s999999 n10 -* +'* cron.*' ${LOGDIR}/cron \
    s999999 n10 -* +'* ftp.*' ${LOGDIR}/ftp \
    s999999 n10 -* +'* local*.*' ${LOGDIR}/local \
    s999999 n10 -* +'* *.debug*' ${LOGDIR}/debug
  </pre>
  note that
  <a href="http://cr.yp.to/daemontools/multilog.html">multilog</a>
  (# man multilog) patterns apply to the timestamps.
</ul>
<hr>
<h2>
listening on udp network socket <tt>0.0.0.0</tt>:<tt>514</tt>:
</h2>
<ul>
  <li>a sample <tt>socklog-inet/run</tt> script is:
  <pre>
  #!/bin/sh
  exec 2>&1
  exec softlimit -m 2000000 envuidgid nobody socklog inet 0 514
  </pre>
  <li>a sample <tt>socklog-inet/log/run</tt> script is:
  <pre>
  #!/bin/sh
  LOGDIR=/var/log/socklog-remote
  exec setuidgid log multilog t ${LOGDIR}/main \
    s4999999 n10 -* +'* 10.0.0.2:*' ${LOGDIR}/10.0.0.2 \
    s4999999 n10 -* +'* 10.0.0.17:*' ${LOGDIR}/10.0.0.17
  </pre>
</ul>
<hr>
<h2>
listening on unix domain stream socket <tt>/dev/log</tt>:
</h2>
<ul>
  <li>a sample <tt>socklog-ucspi-unix/run</tt> script:
  <pre>
  #!/bin/sh
  exec 2>&1
  exec exec softlimit -m 2000000 \
    unixserver -U `id -u nobody` /dev/log -- \
    socklog ucspi UNIXREMOTEEUID UNIXREMOTEEGID
  </pre>
  <li>a sample <tt>socklog-ucspi-unix/log/run</tt> script:
  <pre>
  #!/bin/sh
  LOGDIR=/var/log/socklog
  exec setuidgid log multilog ${LOGDIR}/main \
    s999999 n10 -* +'*: *: kern.*' ${LOGDIR}/kern \
    s999999 n10 -* +'*: *: user.*' ${LOGDIR}/user \
    s999999 n10 -* +'*: *: mail.*' ${LOGDIR}/mail \
    s999999 n10 -* +'*: *: daemon.*' ${LOGDIR}/daemon \
    s999999 n10 -* +'*: *: auth.*' +authpriv.* ${LOGDIR}/auth \
    s999999 n10 -* +'*: *: syslog.*' ${LOGDIR}/syslog \
    s999999 n10 -* +'*: *: news.*' ${LOGDIR}/news \
    s999999 n10 -* +'*: *: cron.*' ${LOGDIR}/cron \
    s999999 n10 -* +'*: *: ftp.*' ${LOGDIR}/ftp \
    s999999 n10 -* +'*: *: local*.*' ${LOGDIR}/local \
    s999999 n10 -* +'*: *: *.debug*' ${LOGDIR}/debug
  </pre>
</ul>
<hr>
<h2>
A client for <a href="network.html">socklog network logging</a>:
</h2>
<ul>
  <li>a sample <tt>socklog-unix/log/run</tt> script that transmits the logs
  to a network logging server running the <i>socklog-ucspi-tcp</i> service is:
  <pre>
  #!/bin/sh
  LOGDIR=/var/log/socklog
  LOGSERVERIP=10.0.0.16
  PORT=10116
  exec setuidgid log multilog s4096 n20 \
    !'tryto -pv tcpclient -v $LOGSERVERIP $PORT sh -c "cat >&7"' \
    ${LOGDIR}/main
  </pre>
</ul>
<hr>
<h2>
<a href="notify.html">log events notification</a> with <i>wall</i>:
</h2>
<ul>
  <li>a sample <tt>socklog-notify/run</tt> script that uses
  <i>wall</i> for notification is:
  <pre>
  #!/bin/sh -e
  PIPE=/var/log/socklog/.notify
  if [ ! -p "$PIPE" ]; then mknod "$PIPE" p; fi
  chmod 666 "$PIPE"
  exec < "$PIPE"
  exec setuidgid log uncat -s49999 -t180 \
    sh -c 'head | wall'
  </pre>
</ul>
<hr>
<address><a href="mailto:pape@smarden.org">
Gerrit Pape &lt;pape@smarden.org&gt;
</a></address>
<small>$Id$</small>
</body>
</html>
