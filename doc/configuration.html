<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<title>socklog - configuration</title>
</head>

<body>
<h1>socklog - configuration</h1>
<hr>
the installation of <i>socklog</i> provides two service directories
for the use with
<a href="http://cr.yp.to/daemontools/svscan.html">svscan</a>:
<ul>
  <li><tt>/etc/socklog/unix/</tt>
  <li><tt>/etc/socklog/inet/</tt>
</ul>
the directory <tt>/etc/socklog/unix/</tt> handles the service listening
to unix domain socket (<tt>/dev/log</tt>), <tt>/etc/socklog/inet/</tt>
handles the service listening to udp socket (<tt>0.0.0.0:514</tt>).
<hr>
to configure the behaviour of <i>socklog</i> services, edit the
appropriate <tt>run</tt> scripts:
<ul>
  <li><tt>/etc/socklog/*/run</tt>
  <li><tt>/etc/socklog/*/log/run</tt>
</ul>
<hr>
to enable one of <i>socklog</i>'s services, stop the default syslog
service first and ensure that it will not be restarted on runlevel
change or system reboot.
<p>
edit the corresponding
<tt>run</tt> scripts once for configuration, e.g. for the unix domain
socket service:
<pre>
  # vi /etc/socklog/unix/run
  # vi /etc/socklog/unix/log/run
</pre>
create the user you chose to run
<a href="http://cr.yp.to/daemontools/multilog.html">multilog</a>
if not yet done and
check carefully that all log directories you stated in
<tt>/etc/socklog/unix/log/run</tt> exist and are writable to this user.
<p>
then link the directory to
<a href="http://cr.yp.to/daemontools.html">daemontools</a>'
<i>service</i> directory, e.g. for the unix domain socket service:
<pre>
  # ln -s /etc/socklog/unix /var/service/socklog-unix
</pre>
wait five seconds for the service to start and then check the log
directories.
<hr>
it is possible to replace the unix domain dgram socket listener
<tt>socklog-unix</tt> with a unix domain stream socket listener using the
<tt>ucspi</tt> mode of <i>socklog</i> and <i>ucspi tools</i> such as
<a href="http://untroubled.org/ucspi-unix/">ucspi-unix</a> and
<a href="http://www.superscript.com/ucspi-ipc/intro.html">ucspi-icp</a>.
<p>
create a service directory <tt>/etc/socklog/ucspi-unix</tt> with a
subdirectory <tt>log</tt> an the correspnding <tt>run</tt> scripts:
<ul>
  <li>a sample <tt>socklog-ucspi-unix/run</tt> script:
      <pre>
  #!/bin/sh
  exec 2>&1
  exec unixserver -U `id -u nobody` /dev/log -- \
    socklog ucspi UNIXREMOTEEUID UNIXREMOTEEGID
      </pre>
  <li>a sample <tt>socklog-ucspi-unix/log/run</tt> script:
      <pre>
  #!/bin/sh
  LOGDIR=/var/log/socklog
  exec setuidgid log multilog ${LOGDIR}/main \
    -* +'*: *: kern.*' ${LOGDIR}/kern \
    -* +'*: *: user.*' ${LOGDIR}/user \
    -* +'*: *: mail.*' ${LOGDIR}/mail \
    -* +'*: *: daemon.*' ${LOGDIR}/daemon \
    -* +'*: *: auth.*' +authpriv.* ${LOGDIR}/auth \
    -* +'*: *: syslog.*' ${LOGDIR}/syslog \
    -* +'*: *: news.*' ${LOGDIR}/news \
    -* +'*: *: cron.*' ${LOGDIR}/cron \
    -* +'*: *: ftp.*' ${LOGDIR}/ftp \
    -* +'*: *: local*.*' ${LOGDIR}/local \
    -* +'*: *: *.debug*' ${LOGDIR}/debug
      </pre>
</ul>
disable the service <tt>socklog-unix</tt> if it is running
<pre>
  # cd /service/socklog-unix
  # rm /service/socklog-unix
  # svc -dx . log
</pre>
check carefully that all log directories you stated in
<tt>/etc/socklog/ucspi-unix/log/run</tt> exist and are writable the
corresponding user.
<p>
then link the directory to
<a href="http://cr.yp.to/daemontools.html">daemontools</a>'
<i>service</i> directory:
<pre>
  # ln -s /etc/socklog/ucspi-unix /var/service/socklog-ucspi-unix
</pre>
wait five seconds for the service to start and then check the log
directories.
<hr>
See <a href="examples.html">Examples</a> for more sample <tt>run</tt>
and <tt>log/run</tt> scripts.
<hr>
<address><a href="mailto:pape@innominate.com">G. Pape</a></address>
<small>$Id$</small>
</body>
</html>
